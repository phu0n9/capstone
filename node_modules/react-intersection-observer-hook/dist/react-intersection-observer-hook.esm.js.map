{"version":3,"file":"react-intersection-observer-hook.esm.js","sources":["../src/useIntersectionObserver.ts","../src/useTrackVisibility.ts"],"sourcesContent":["import { useState, useCallback, useEffect, useRef } from 'react';\r\n\r\nconst DEFAULT_ROOT_MARGIN = '0px';\r\nconst DEFAULT_THRESHOLD = [0];\r\n\r\n// eslint-disable-next-line no-undef\r\nexport type IntersectionObserverHookArgs = IntersectionObserverInit;\r\n\r\nexport type IntersectionObserverHookRefCallbackNode = Element | null;\r\n\r\nexport type IntersectionObserverHookRefCallback = (\r\n  node: IntersectionObserverHookRefCallbackNode,\r\n) => void;\r\n\r\nexport type IntersectionObserverHookRootRefCallbackNode = IntersectionObserverHookArgs['root'];\r\n\r\nexport type IntersectionObserverHookRootRefCallback = (\r\n  node: IntersectionObserverHookRootRefCallbackNode,\r\n) => void;\r\n\r\nexport type IntersectionObserverHookResult = [\r\n  IntersectionObserverHookRefCallback,\r\n  {\r\n    entry: IntersectionObserverEntry | undefined;\r\n    rootRef: IntersectionObserverHookRootRefCallback;\r\n  },\r\n];\r\n\r\n// For more info:\r\n// https://developers.google.com/web/updates/2016/04/intersectionobserver\r\n// https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\r\nfunction useIntersectionObserver(\r\n  args?: IntersectionObserverHookArgs,\r\n): IntersectionObserverHookResult {\r\n  const rootMargin = args?.rootMargin ?? DEFAULT_ROOT_MARGIN;\r\n  const threshold = args?.threshold ?? DEFAULT_THRESHOLD;\r\n\r\n  const nodeRef = useRef<IntersectionObserverHookRefCallbackNode>(null);\r\n  const rootRef = useRef<IntersectionObserverHookRootRefCallbackNode>(null);\r\n  const observerRef = useRef<IntersectionObserver | null>(null);\r\n\r\n  const [entry, setEntry] = useState<IntersectionObserverEntry>();\r\n\r\n  const unobserve = useCallback(() => {\r\n    // Disconnect the current observer (if there is one)\r\n    const currentObserver = observerRef.current;\r\n    currentObserver?.disconnect();\r\n    observerRef.current = null;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      // We disconnect the observer on unmount to prevent memory leaks etc.\r\n      unobserve();\r\n    };\r\n  }, [unobserve]);\r\n\r\n  const observe = useCallback(() => {\r\n    const node = nodeRef.current;\r\n    if (node) {\r\n      const root = rootRef.current;\r\n      const options = { root, rootMargin, threshold };\r\n      // Create a observer for current \"node\" with given options.\r\n      const observer = new IntersectionObserver(([newEntry]) => {\r\n        setEntry(newEntry);\r\n      }, options);\r\n      observer.observe(node);\r\n      observerRef.current = observer;\r\n    }\r\n  }, [rootMargin, threshold]);\r\n\r\n  const initializeObserver = useCallback(() => {\r\n    unobserve();\r\n    observe();\r\n  }, [observe, unobserve]);\r\n\r\n  const refCallback = useCallback<IntersectionObserverHookRefCallback>(\r\n    (node) => {\r\n      nodeRef.current = node;\r\n      initializeObserver();\r\n    },\r\n    [initializeObserver],\r\n  );\r\n\r\n  const rootRefCallback = useCallback<IntersectionObserverHookRootRefCallback>(\r\n    (rootNode) => {\r\n      rootRef.current = rootNode;\r\n      initializeObserver();\r\n    },\r\n    [initializeObserver],\r\n  );\r\n\r\n  return [refCallback, { entry, rootRef: rootRefCallback }];\r\n}\r\n\r\nexport default useIntersectionObserver;\r\n","import { useEffect, useState } from 'react';\r\nimport useIntersectionObserver, {\r\n  IntersectionObserverHookArgs,\r\n  IntersectionObserverHookResult,\r\n} from './useIntersectionObserver';\r\n\r\nexport type TrackVisibilityHookArgs = IntersectionObserverHookArgs;\r\n\r\nexport type TrackVisibilityHookResult = [\r\n  IntersectionObserverHookResult[0],\r\n  IntersectionObserverHookResult[1] & {\r\n    isVisible: boolean;\r\n    wasEverVisible: boolean;\r\n  },\r\n];\r\n\r\nfunction useTrackVisibility(\r\n  args?: IntersectionObserverHookArgs,\r\n): TrackVisibilityHookResult {\r\n  const [ref, result] = useIntersectionObserver(args);\r\n  const isVisible = Boolean(result.entry?.isIntersecting);\r\n  const [wasEverVisible, setWasEverVisible] = useState(isVisible);\r\n\r\n  useEffect(() => {\r\n    if (isVisible) {\r\n      setWasEverVisible(isVisible);\r\n    }\r\n  }, [isVisible]);\r\n\r\n  return [ref, { ...result, isVisible, wasEverVisible }];\r\n}\r\n\r\nexport default useTrackVisibility;\r\n"],"names":["DEFAULT_ROOT_MARGIN","DEFAULT_THRESHOLD","useIntersectionObserver","args","rootMargin","threshold","nodeRef","useRef","rootRef","observerRef","useState","entry","setEntry","unobserve","useCallback","currentObserver","current","disconnect","useEffect","observe","node","root","options","observer","IntersectionObserver","newEntry","initializeObserver","refCallback","rootRefCallback","rootNode","useTrackVisibility","ref","result","isVisible","Boolean","isIntersecting","wasEverVisible","setWasEverVisible"],"mappings":"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"}