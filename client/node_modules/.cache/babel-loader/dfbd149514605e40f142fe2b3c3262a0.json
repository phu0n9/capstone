{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport Pusher from 'pusher-js';\nimport { useAuth0 } from '@auth0/auth0-react';\n\nrequire('dotenv').config();\n\nexport default function InfinityScroll(pageNumber, keyword) {\n  _s();\n\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(false);\n  const [inventory, setInventory] = useState([]);\n  const [hasMore, setHasMore] = useState(false);\n  const heroku = 'https://schaeffler.herokuapp.com/';\n  const {\n    isAuthenticated,\n    getAccessTokenSilently\n  } = useAuth0();\n  useEffect(() => {\n    async function fetchApi(URL, paramsDict) {\n      if (isAuthenticated) {\n        const token = await getAccessTokenSilently();\n        await axios({\n          method: 'GET',\n          url: URL,\n          params: paramsDict,\n          headers: {\n            authorization: `Bearer ${token}`\n          }\n        }).then(res => {\n          setInventory(() => {\n            return [...new Set([...'', ...res.data.map(i => i)])];\n          });\n          setHasMore(res.data.length > 0);\n          setLoading(false);\n        }).catch(e => {\n          setError(true);\n          console.log('Error: ' + e);\n        });\n      }\n    }\n\n    const pusher = new Pusher(process.env.REACT_APP_PUSHER_KEY, {\n      'cluster': process.env.REACT_APP_PUSHER_CLUSTER,\n      forceTLS: true\n    });\n    const channel = pusher.subscribe('tasks');\n    channel.bind('inserted', function () {\n      fetchApi('http://localhost:5000/inventory', {\n        page: pageNumber\n      }); //change here\n      // fetchApi(heroku+'inventory',{page:5}) //change here\n    });\n    channel.bind('itemDeleted', function () {\n      fetchApi('http://localhost:5000/inventory', {\n        page: pageNumber\n      }); //change here\n      // fetchApi(heroku+'inventory',{page:5}) //change here\n    });\n    return () => channel.unbind('inserted');\n  }, [isAuthenticated, getAccessTokenSilently, pageNumber]);\n  useEffect(() => {\n    async function getPages() {\n      if (isAuthenticated) {\n        const token = await getAccessTokenSilently();\n\n        if (keyword) {\n          setLoading(true);\n          setError(false);\n          await axios({\n            method: 'GET',\n            url: `http://localhost:5000/inventory/search/${keyword}`,\n            //change here\n            // url: heroku+`inventory/search/${keyword}`, //change here\n            headers: {\n              'Authorization': `Bearer ${token}`\n            }\n          }).then(res => {\n            setInventory(() => {\n              return [...new Set([...'', ...res.data.map(i => i)])];\n            });\n            setHasMore(res.data.length > 0);\n            setLoading(false);\n          }).catch(e => {\n            setError(true);\n            console.log('Error: ' + e);\n          });\n        } else {\n          setLoading(true);\n          setError(false);\n          await axios({\n            method: 'GET',\n            url: 'http://localhost:5000/inventory',\n            //change here\n            // url: heroku+'inventory', //change here\n            params: {\n              page: pageNumber\n            },\n            headers: {\n              'Authorization': `Bearer ${token}`\n            }\n          }).then(res => {\n            setInventory(prevInventory => {\n              return [...new Set([...prevInventory, ...res.data.map(i => i)])];\n            });\n            setHasMore(res.data.length > 0);\n            setLoading(false);\n          }).catch(e => {\n            setError(true);\n            console.log('Error: ' + e);\n          });\n        }\n      }\n    }\n\n    getPages();\n  }, [pageNumber, isAuthenticated, getAccessTokenSilently, keyword]);\n  return {\n    loading,\n    hasMore,\n    error,\n    inventory\n  };\n}\n\n_s(InfinityScroll, \"B/uXfFjXsBNgDvJDwZHPDM9VIwY=\", false, function () {\n  return [useAuth0];\n});\n\n_c = InfinityScroll;\n\nvar _c;\n\n$RefreshReg$(_c, \"InfinityScroll\");","map":{"version":3,"sources":["C:/Users/Admin/Downloads/capstone/schaeffler/client/src/InfinityScroll.js"],"names":["useEffect","useState","axios","Pusher","useAuth0","require","config","InfinityScroll","pageNumber","keyword","loading","setLoading","error","setError","inventory","setInventory","hasMore","setHasMore","heroku","isAuthenticated","getAccessTokenSilently","fetchApi","URL","paramsDict","token","method","url","params","headers","authorization","then","res","Set","data","map","i","length","catch","e","console","log","pusher","process","env","REACT_APP_PUSHER_KEY","REACT_APP_PUSHER_CLUSTER","forceTLS","channel","subscribe","bind","page","unbind","getPages","prevInventory"],"mappings":";;AAAA,SAAQA,SAAR,EAAkBC,QAAlB,QAAiC,OAAjC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,SAAQC,QAAR,QAAuB,oBAAvB;;AACAC,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAAlB;;AAEA,eAAe,SAASC,cAAT,CAAwBC,UAAxB,EAAmCC,OAAnC,EAA4C;AAAA;;AACvD,QAAM,CAACC,OAAD,EAASC,UAAT,IAAuBV,QAAQ,CAAC,IAAD,CAArC;AACA,QAAM,CAACW,KAAD,EAAOC,QAAP,IAAmBZ,QAAQ,CAAC,KAAD,CAAjC;AACA,QAAM,CAACa,SAAD,EAAWC,YAAX,IAA2Bd,QAAQ,CAAC,EAAD,CAAzC;AACA,QAAM,CAACe,OAAD,EAASC,UAAT,IAAuBhB,QAAQ,CAAC,KAAD,CAArC;AACA,QAAMiB,MAAM,GAAG,mCAAf;AACA,QAAM;AAACC,IAAAA,eAAD;AAAiBC,IAAAA;AAAjB,MAA2ChB,QAAQ,EAAzD;AAGAJ,EAAAA,SAAS,CAAC,MAAK;AACX,mBAAeqB,QAAf,CAAwBC,GAAxB,EAA4BC,UAA5B,EAAuC;AACnC,UAAGJ,eAAH,EAAmB;AACf,cAAMK,KAAK,GAAG,MAAMJ,sBAAsB,EAA1C;AACA,cAAMlB,KAAK,CAAC;AACRuB,UAAAA,MAAM,EAAC,KADC;AAERC,UAAAA,GAAG,EAAEJ,GAFG;AAGRK,UAAAA,MAAM,EAACJ,UAHC;AAIRK,UAAAA,OAAO,EAAE;AACLC,YAAAA,aAAa,EAAE,UAASL,KAAM;AADzB;AAJD,SAAD,CAAL,CAQLM,IARK,CAQAC,GAAG,IAAI;AACThB,UAAAA,YAAY,CAAC,MAAK;AACd,mBAAO,CAAC,GAAG,IAAIiB,GAAJ,CAAQ,CAAC,GAAG,EAAJ,EAAO,GAAGD,GAAG,CAACE,IAAJ,CAASC,GAAT,CAAaC,CAAC,IAAIA,CAAlB,CAAV,CAAR,CAAJ,CAAP;AACH,WAFW,CAAZ;AAGAlB,UAAAA,UAAU,CAACc,GAAG,CAACE,IAAJ,CAASG,MAAT,GAAkB,CAAnB,CAAV;AACAzB,UAAAA,UAAU,CAAC,KAAD,CAAV;AACH,SAdK,EAeL0B,KAfK,CAeCC,CAAC,IAAG;AACPzB,UAAAA,QAAQ,CAAC,IAAD,CAAR;AACA0B,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAUF,CAAtB;AACH,SAlBK,CAAN;AAmBH;AACJ;;AACD,UAAMG,MAAM,GAAG,IAAItC,MAAJ,CAAWuC,OAAO,CAACC,GAAR,CAAYC,oBAAvB,EAA4C;AACvD,iBAAUF,OAAO,CAACC,GAAR,CAAYE,wBADiC;AAEvDC,MAAAA,QAAQ,EAAE;AAF6C,KAA5C,CAAf;AAIA,UAAMC,OAAO,GAAGN,MAAM,CAACO,SAAP,CAAiB,OAAjB,CAAhB;AACAD,IAAAA,OAAO,CAACE,IAAR,CAAa,UAAb,EAAwB,YAAU;AAC9B5B,MAAAA,QAAQ,CAAC,iCAAD,EAAmC;AAAC6B,QAAAA,IAAI,EAAC1C;AAAN,OAAnC,CAAR,CAD8B,CACgC;AAC9D;AACH,KAHD;AAIAuC,IAAAA,OAAO,CAACE,IAAR,CAAa,aAAb,EAA2B,YAAU;AACjC5B,MAAAA,QAAQ,CAAC,iCAAD,EAAmC;AAAC6B,QAAAA,IAAI,EAAC1C;AAAN,OAAnC,CAAR,CADiC,CAC6B;AAC9D;AACH,KAHD;AAIA,WAAO,MAAMuC,OAAO,CAACI,MAAR,CAAe,UAAf,CAAb;AACH,GAvCQ,EAuCP,CAAChC,eAAD,EAAiBC,sBAAjB,EAAwCZ,UAAxC,CAvCO,CAAT;AAyCAR,EAAAA,SAAS,CAAC,MAAK;AACX,mBAAeoD,QAAf,GAAyB;AACrB,UAAGjC,eAAH,EAAmB;AACf,cAAMK,KAAK,GAAG,MAAMJ,sBAAsB,EAA1C;;AAEA,YAAIX,OAAJ,EAAY;AACRE,UAAAA,UAAU,CAAC,IAAD,CAAV;AACAE,UAAAA,QAAQ,CAAC,KAAD,CAAR;AACA,gBAAMX,KAAK,CAAC;AACRuB,YAAAA,MAAM,EAAC,KADC;AAERC,YAAAA,GAAG,EAAG,0CAAyCjB,OAAQ,EAF/C;AAEkD;AAC1D;AACAmB,YAAAA,OAAO,EAAC;AACJ,+BAAiB,UAASJ,KAAM;AAD5B;AAJA,WAAD,CAAL,CAQLM,IARK,CAQAC,GAAG,IAAI;AACThB,YAAAA,YAAY,CAAC,MAAK;AACd,qBAAO,CAAC,GAAG,IAAIiB,GAAJ,CAAQ,CAAC,GAAG,EAAJ,EAAO,GAAGD,GAAG,CAACE,IAAJ,CAASC,GAAT,CAAaC,CAAC,IAAIA,CAAlB,CAAV,CAAR,CAAJ,CAAP;AACH,aAFW,CAAZ;AAGIlB,YAAAA,UAAU,CAACc,GAAG,CAACE,IAAJ,CAASG,MAAT,GAAkB,CAAnB,CAAV;AACAzB,YAAAA,UAAU,CAAC,KAAD,CAAV;AACP,WAdK,EAeL0B,KAfK,CAeCC,CAAC,IAAG;AACPzB,YAAAA,QAAQ,CAAC,IAAD,CAAR;AACA0B,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAUF,CAAtB;AACH,WAlBK,CAAN;AAmBH,SAtBD,MAuBI;AACA3B,UAAAA,UAAU,CAAC,IAAD,CAAV;AACAE,UAAAA,QAAQ,CAAC,KAAD,CAAR;AACA,gBAAMX,KAAK,CAAC;AACRuB,YAAAA,MAAM,EAAC,KADC;AAERC,YAAAA,GAAG,EAAE,iCAFG;AAEgC;AACxC;AACAC,YAAAA,MAAM,EAAC;AAACuB,cAAAA,IAAI,EAAC1C;AAAN,aAJC;AAKRoB,YAAAA,OAAO,EAAC;AACJ,+BAAiB,UAASJ,KAAM;AAD5B;AALA,WAAD,CAAL,CASLM,IATK,CASAC,GAAG,IAAI;AACThB,YAAAA,YAAY,CAACsC,aAAa,IAAG;AACzB,qBAAO,CAAC,GAAG,IAAIrB,GAAJ,CAAQ,CAAC,GAAGqB,aAAJ,EAAkB,GAAGtB,GAAG,CAACE,IAAJ,CAASC,GAAT,CAAaC,CAAC,IAAIA,CAAlB,CAArB,CAAR,CAAJ,CAAP;AACH,aAFW,CAAZ;AAGIlB,YAAAA,UAAU,CAACc,GAAG,CAACE,IAAJ,CAASG,MAAT,GAAkB,CAAnB,CAAV;AACAzB,YAAAA,UAAU,CAAC,KAAD,CAAV;AACP,WAfK,EAgBL0B,KAhBK,CAgBCC,CAAC,IAAG;AACPzB,YAAAA,QAAQ,CAAC,IAAD,CAAR;AACA0B,YAAAA,OAAO,CAACC,GAAR,CAAY,YAAUF,CAAtB;AACH,WAnBK,CAAN;AAoBH;AACJ;AACJ;;AAEDc,IAAAA,QAAQ;AACX,GAxDQ,EAwDP,CAAC5C,UAAD,EAAYW,eAAZ,EAA4BC,sBAA5B,EAAmDX,OAAnD,CAxDO,CAAT;AA0DA,SAAO;AAACC,IAAAA,OAAD;AAASM,IAAAA,OAAT;AAAiBJ,IAAAA,KAAjB;AAAuBE,IAAAA;AAAvB,GAAP;AACH;;GA7GuBP,c;UAM6BH,Q;;;KAN7BG,c","sourcesContent":["import {useEffect,useState} from 'react'\r\nimport axios from 'axios'\r\nimport Pusher from 'pusher-js'\r\nimport {useAuth0} from '@auth0/auth0-react'\r\nrequire('dotenv').config()\r\n\r\nexport default function InfinityScroll(pageNumber,keyword) {\r\n    const [loading,setLoading] = useState(true)\r\n    const [error,setError] = useState(false)\r\n    const [inventory,setInventory] = useState([])\r\n    const [hasMore,setHasMore] = useState(false)       \r\n    const heroku = 'https://schaeffler.herokuapp.com/'\r\n    const {isAuthenticated,getAccessTokenSilently} = useAuth0()\r\n\r\n   \r\n    useEffect(() =>{\r\n        async function fetchApi(URL,paramsDict){\r\n            if(isAuthenticated){\r\n                const token = await getAccessTokenSilently()\r\n                await axios({\r\n                    method:'GET',\r\n                    url: URL,\r\n                    params:paramsDict,\r\n                    headers: {\r\n                        authorization:`Bearer ${token}`\r\n                    }\r\n                })\r\n                .then(res => {\r\n                    setInventory(() =>{\r\n                        return [...new Set([...'',...res.data.map(i => i)])]\r\n                    })\r\n                    setHasMore(res.data.length > 0)\r\n                    setLoading(false)\r\n                })\r\n                .catch(e =>{\r\n                    setError(true)\r\n                    console.log('Error: '+e)\r\n                })\r\n            }\r\n        }    \r\n        const pusher = new Pusher(process.env.REACT_APP_PUSHER_KEY,{\r\n            'cluster':process.env.REACT_APP_PUSHER_CLUSTER,\r\n            forceTLS: true,\r\n        })\r\n        const channel = pusher.subscribe('tasks')\r\n        channel.bind('inserted',function(){\r\n            fetchApi('http://localhost:5000/inventory',{page:pageNumber}) //change here\r\n            // fetchApi(heroku+'inventory',{page:5}) //change here\r\n        })\r\n        channel.bind('itemDeleted',function(){\r\n            fetchApi('http://localhost:5000/inventory',{page:pageNumber}) //change here\r\n            // fetchApi(heroku+'inventory',{page:5}) //change here\r\n        })\r\n        return () => channel.unbind('inserted')\r\n    },[isAuthenticated,getAccessTokenSilently,pageNumber])\r\n\r\n    useEffect(() =>{\r\n        async function getPages(){\r\n            if(isAuthenticated){\r\n                const token = await getAccessTokenSilently()\r\n                \r\n                if (keyword){\r\n                    setLoading(true)\r\n                    setError(false)\r\n                    await axios({\r\n                        method:'GET',\r\n                        url: `http://localhost:5000/inventory/search/${keyword}`, //change here\r\n                        // url: heroku+`inventory/search/${keyword}`, //change here\r\n                        headers:{\r\n                            'Authorization':`Bearer ${token}`\r\n                        }\r\n                    })\r\n                    .then(res => {\r\n                        setInventory(() =>{\r\n                            return [...new Set([...'',...res.data.map(i => i)])]\r\n                        })\r\n                            setHasMore(res.data.length > 0)\r\n                            setLoading(false)\r\n                    })\r\n                    .catch(e =>{\r\n                        setError(true)\r\n                        console.log('Error: '+e)\r\n                    })\r\n                }\r\n                else{\r\n                    setLoading(true)\r\n                    setError(false)\r\n                    await axios({\r\n                        method:'GET',\r\n                        url: 'http://localhost:5000/inventory', //change here\r\n                        // url: heroku+'inventory', //change here\r\n                        params:{page:pageNumber},\r\n                        headers:{\r\n                            'Authorization':`Bearer ${token}`\r\n                        }\r\n                    })\r\n                    .then(res => {\r\n                        setInventory(prevInventory =>{\r\n                            return [...new Set([...prevInventory,...res.data.map(i => i)])]\r\n                        })\r\n                            setHasMore(res.data.length > 0)\r\n                            setLoading(false)\r\n                    })\r\n                    .catch(e =>{\r\n                        setError(true)\r\n                        console.log('Error: '+e)\r\n                    })\r\n                }\r\n            }\r\n        }\r\n        \r\n        getPages()\r\n    },[pageNumber,isAuthenticated,getAccessTokenSilently,keyword])\r\n\r\n    return {loading,hasMore,error,inventory}\r\n}\r\n"]},"metadata":{},"sourceType":"module"}